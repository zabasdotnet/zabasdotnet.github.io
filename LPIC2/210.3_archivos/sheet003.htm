<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=UTF-8">
<meta name=ProgId content=Excel.Sheet>
<meta name=Generator content="Microsoft Excel 15">
<link id=Main-File rel=Main-File href="../210.3.htm">
<link rel=File-List href=filelist.xml>
<title>200.1 - Measure and Troubleshoot Resource Usage</title>
<link rel=Stylesheet href=stylesheet.css>
<style>
<!--table
	{mso-displayed-decimal-separator:"\,";
	mso-displayed-thousand-separator:"\.";}
@page
	{margin:.75in .7in .75in .7in;
	mso-header-margin:.3in;
	mso-footer-margin:.3in;}
-->
</style>
<![if !supportTabStrip]><script language="JavaScript">
<!--
function fnUpdateTabs()
 {
  if (parent.window.g_iIEVer>=4) {
   if (parent.document.readyState=="complete"
    && parent.frames['frTabs'].document.readyState=="complete")
   parent.fnSetActiveSheet(2);
  else
   window.setTimeout("fnUpdateTabs();",150);
 }
}

if (window.name!="frSheet")
 window.location.replace("../210.3.htm");
else
 fnUpdateTabs();
//-->
</script>
<![endif]>
</head>

<body link=blue vlink=purple class=xl67>

<table border=0 cellpadding=0 cellspacing=0 width=1598 style='border-collapse:
 collapse;table-layout:fixed;width:1199pt'>
 <col class=xl67 width=1598 style='mso-width-source:userset;mso-width-alt:58441;
 width:1199pt'>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl65 width=1598 style='height:15.0pt;width:1199pt'>Autentificación
  por LDAP en sistemas Linux</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>En el
  marco de los objetivos <font class="font16">LPI</font><font class="font0">,
  supondremos aquí que ya tenemos un directorio activo en línea y que las
  cuentas se han creado con todos los atributos necesarios para la
  autentificación en Linux.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl65 width=1598 style='height:15.0pt;width:1199pt'>1.
  Configuración NSS</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>La
  autentificación solo será posible si la información de los usuarios está
  accesible vía <font class="font15">NSS</font><font class="font0">.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl65 width=1598 style='height:15.0pt;width:1199pt'>a.
  Configuración de la librería NSS para LDAP</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>La
  librería <font class="font5">NSS</font><font class="font0">, responsable de
  consultar al directorio, tiene que disponer de la información necesaria.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Para
  ello, hay que rellenar el archivo de configuración <font class="font5">LDAP</font><font
  class="font0"> para la librería nss ldap.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Generalmente,
  este archivo se llama ldap.conf y se ubica directamente en el directorio <font
  class="font15">/etc</font><font class="font0">.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Esta
  configuración requiere que la <font class="font5">librería</font><font
  class="font0"> </font><font class="font5">NSS</font><font class="font0"> sea
  capaz de gestionar la información </font><font class="font5">LDAP</font><font
  class="font0">.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Generalmente,
  esta funcionalidad la proporciona un paquete llamado <font class="font15">libnss_ldap</font><font
  class="font0">.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl65 width=1598 style='height:15.0pt;width:1199pt'>*Ejemplo
  de archivo /etc/dap.conf</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Este
  archivo utilizado por <font class="font5">NSS</font><font class="font0"> es
  extremadamente parecido al usado por los clientes </font><font class="font5">LDAP</font><font
  class="font0">.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl75 width=1598 style='height:15.0pt;width:1199pt'>host
  127.0.0.1<span style='mso-spacerun:yes'> </span></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl75 width=1598 style='height:15.0pt;width:1199pt'>base
  dc=pas,dc=net<span style='mso-spacerun:yes'> </span></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl75 width=1598 style='height:15.0pt;width:1199pt'>ldap_version
  3<span style='mso-spacerun:yes'> </span></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl75 width=1598 style='height:15.0pt;width:1199pt'>rootbinddn
  cn=admin,dc=pas,dc=net</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl65 width=1598 style='height:15.0pt;width:1199pt'>b.
  Informando las fuentes de nombres</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>El
  archivo <font class="font16">/etc/nsswitch</font><font class="font0"> se debe
  configurar para hacer referencia a LDAP como fuente de información
  prioritaria.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Sin
  embargo, debe seguir funcionando con los archivos locales para cuando el
  directorio no esté disponible.</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl65 width=1598 style='height:15.0pt;width:1199pt'>*Modificación
  del archivo nsswitch con LDAP como fuente de nombres prioritaria</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl76 width=1598 style='height:15.0pt;width:1199pt'>passwd
  : ldap files<span style='mso-spacerun:yes'> </span></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl76 width=1598 style='height:15.0pt;width:1199pt'>group:
  ldap files<span style='mso-spacerun:yes'> </span></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl76 width=1598 style='height:15.0pt;width:1199pt'>shadow:
  ldap files</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl65 width=1598 style='height:15.0pt;width:1199pt'>c.
  Comprobación de las fuentes de nombres</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>A
  menudo es difícil diagnosticar problemas relacionados con la autentificación <font
  class="font5">LDAP</font><font class="font0">.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>En
  efecto, se puede alterar el buen funcionamiento por falta de disponibilidad
  del directorio, por cuentas de usuarios mal creadas o por una mala
  configuración del cliente.</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>La
  herramienta getent permite en este caso comprobar que el cliente es capaz de
  realizar consultas al directorio <font class="font5">LDAP</font><font
  class="font0"> y obtener información correcta.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl65 width=1598 style='height:15.0pt;width:1199pt'>*Ejemplo
  de comprobación de datos de cuentas con getent</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>La
  configuración de una autentificación <font class="font5">LDAP</font><font
  class="font0"> no es particularmente fácil; esta comprobación en mitad del
  proceso es bienvenida.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl76 width=1598 style='height:15.0pt;width:1199pt'>root@estacion:/etc$
  getent passwd titi<span style='mso-spacerun:yes'> </span></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl75 width=1598 style='height:15.0pt;width:1199pt'>titi:*:1101:1101:titi:/home/titi/bin/bash<span
  style='mso-spacerun:yes'> </span></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl75 width=1598 style='height:15.0pt;width:1199pt'>root@estacion:/etc$</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl65 width=1598 style='height:15.0pt;width:1199pt'>2.
  Configuración PAM</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>a.
  Identificación de los servicios necesarios</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Según
  las necesidades, todos o parte de los servicios que usan <font class="font5">PAM</font><font
  class="font0"> tienen que poder apoyarse en la autentificación </font><font
  class="font5">LDAP</font><font class="font0">.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Por
  ejemplo, las aplicaciones de login, su y ssh solamente para necesidades
  administrativas o bien todo elemento capaz de solicitar una autentificación.</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Siguiendo
  la filosofía de <font class="font5">PAM</font><font class="font0">, habría
  que identificar todos los elementos de configuración para cada una de las
  aplicaciones involucradas y modificar su configuración para que puedan usar </font><font
  class="font5">LDAP</font><font class="font0"> como posible mecanismo de
  autentificación.<span style='mso-spacerun:yes'> </span></font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Afortunadamente,
  las distribuciones Linux modernas facilitan la tarea concentrando en los
  archivos common-action para Debian o system-auth para Red Hat la
  configuración de todas las aplicaciones que comparten los mismos modos de
  autentificación.</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Por
  tanto, nos bastará con modificar estos archivos para cambiar el modo de
  autentificación de todas las aplicaciones del sistema.</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl65 width=1598 style='height:15.0pt;width:1199pt'>b.
  Configuración de los archivos PAM</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Los
  tipos de acción <font class="font5">PAM account y auth</font><font
  class="font0"> deben modificarse para permitir la autentificación </font><font
  class="font5">LDAP</font><font class="font0">.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Si se
  consulta su contenido inicial, se ve que configuran el módulo<font
  class="font5"> pam_unix.so</font><font class="font0">, en general con el
  control required o sufficient.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>La
  primera regla es no tocar estas líneas de la configuración.</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>En
  efecto, incluso si se desea utilizar un directorio LDAP para las operaciones
  de autentificación, ante todo se debe conservar el mecanismo tradicional,
  aunque solo sea para permitir la autentificación local en caso de fallo del
  directorio.</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Por
  tanto, la configuración se realizará añadiendo para las acciones account y
  auth una línea indicando como sufficient la autenticación por el módulo LDAP <font
  class="font5">(pam_ldap.so)</font><font class="font0">.</font></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Se
  podrá evitar una doble entrada de contraseña añadiendo la opción
  use_first_pass, que permitirá reutilizar la contraseña introducida en el
  primer intento de conexión.</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl65 width=1598 style='height:15.0pt;width:1199pt'>*Extracto
  del archivo system-auth modificado en una distribución Red Hat</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>El
  parámetro use_first_pass indica al sistema que debe intentar la
  autentificación en el módulo pam_ldap con los mismos identificadores que los
  que se usaron con el módulo pam_unix.</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'>Así se
  evita que el usuario introduzca dos veces sus credenciales.</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl75 width=1598 style='height:15.0pt;width:1199pt'>auth<span
  style='mso-spacerun:yes'>     </span>sufficient<span
  style='mso-spacerun:yes'>  </span>pam_unix.so<span style='mso-spacerun:yes'> 
  </span>nullok<span style='mso-spacerun:yes'> </span></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl75 width=1598 style='height:15.0pt;width:1199pt'>auth<span
  style='mso-spacerun:yes'>     </span>sufficient<span
  style='mso-spacerun:yes'>  </span>pam_ldap.so<span style='mso-spacerun:yes'> 
  </span>use_first_pass<span style='mso-spacerun:yes'> </span></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl75 width=1598 style='height:15.0pt;width:1199pt'>account<span
  style='mso-spacerun:yes'>  </span>sufficient<span style='mso-spacerun:yes'> 
  </span>pam_unix.so<span style='mso-spacerun:yes'> </span></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl75 width=1598 style='height:15.0pt;width:1199pt'>account<span
  style='mso-spacerun:yes'>  </span>sufficient<span style='mso-spacerun:yes'> 
  </span>pam_ldap.so</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl67 width=1598 style='height:15.0pt;width:1199pt'><span
  style='mso-spacerun:yes'> </span></td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=0 style='display:none'>
  <td width=1598 style='width:1199pt'></td>
 </tr>
 <![endif]>
</table>

</body>

</html>
